- hosts: all
  tasks:
    - name: install packages
      yum:
        name: ipa-client
        state: installed


- hosts: all
  serial: 1
  vars:
    otp_password: Secret123
    dns_server: 192.168.190.38
  tasks:
    - name: pre-register host
      command: ipa host-add --password {{ otp_password }} --force {{ ansible_fqdn }}
      delegate_to: localhost

    - name: enroll server
      command: ipa-client-install -w {{ otp_password }} -U
